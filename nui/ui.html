<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <script src="scripts.js" type="text/javascript"></script>
    <script src="debounce.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="styles.css" type="text/css">
    <title>Inventory</title>
</head>

<body>
    <div id="ActionBar"> </div>
    <div id="UseBar"> </div>
    <div id="app" style="height:100%;width:100%;">
        <div class="inventory" style="height:100%;width:100%;">
            <div class='move-form'>
                <input type='text' id='search-text' placeholder='Search'>
                <input type='number' id='move-amount' max='99' min='0' placeholder='Amount'>
                <div id="Use" class='buttondude sans Use'>USE</div>
                <div id="CloseInv" class='buttondude sans CloseInv' onclick="closeInv()">Close</div>
            </div>
            <div id="Logs" class='Logs'>Inventory Opened.</div>
            <div id="CurrentInformation" class='CurrentInformation'></div>
            <div id="wrapPersonalWeight" class="wrapPersonalWeight">
            </div>
            <div id="wrapSecondaryWeight" class="wrapSecondaryWeight">
            </div>
            <div id="wrapPersonalWeight1" class="wrapPersonalWeight1">
            </div>
            <div id="wrapSecondaryWeight1" class="wrapSecondaryWeight1">
            </div>
            <div id="draggedItem">
            </div>
            <div id="wrapmain" class="wrapmain"></div>
            <div id="wrapsecondary" class="wrapsecondary"></div>
        </div>
    </div>
</body>

</html>

<script>
    let dragging = false;
let draggingid = "none";
let mousedown = false;
let personalWeight = 0;
let secondaryWeight = 0;
let personalMaxWeight = 250;
let secondaryMaxWeight = 250;
let movementAmount = 0;
let currentInventory = 0;
let weight = 0;
let amount = 0;
let name = 0;
let itemid = 0;
let slotusing = 0;
let inventoryUsedName = "none";
let curGPSLength = 0
let cursorX = 0;
let cursorY = 0;
let purchase = false;
let crafting = false;
let clicking = false;
let userCash = 0;
let itemList = {}
let exluded = {}
let brought = false;
let dateNow = Date.now()
let isCop = false;

exluded["2578778090"] = true
exluded["1737195953"] = true
exluded["1317494643"] = true
exluded["2508868239"] = true
exluded["1141786504"] = true
exluded["2227010557"] = true
exluded["883325847"] = true
exluded["4192643659"] = true
exluded["2460120199"] = true
exluded["3638508604"] = true
exluded["4191993645"] = true
exluded["3713923289"] = true
exluded["2343591895"] = true
exluded["2484171525"] = true
exluded["419712736"] = true
exluded["-1810795771"] = true
let shiftHeld = false
let CtrlHeld = false
$(document).ready(function () {

  document.onmousemove = handleMouseMove;


  document.onkeydown = function (data) {
    if (data.which == 73 || data.which == 27 || data.which == 113) {
      closeInv()
    } else if (data.which == 16) {
      shiftHeld = true
    } else if (data.which == 17) {
      CtrlHeld = true
    } else if (data.which == 107) {
    }
  }
  document.onkeyup = function (data) {
    if (data.which == 16) {
      shiftHeld = false
    }
    if (data.which == 107) {
    }
    if (data.which == 17) {
      CtrlHeld = false
    }
    else {

      searchUpdate()
    }
  }


  function handleMouseMove(event) {
    let dot, eventDoc, doc, body, pageX, pageY;
    event = event || window.event; // IE-ism
    // If pageX/Y aren't available and clientX/Y are,
    // calculate pageX/Y - logic taken from jQuery.
    // (This is to support old IE)
    if (event.pageX == null && event.clientX != null) {
      eventDoc = (event.target && event.target.ownerDocument) || document;
      doc = eventDoc.documentElement;
      body = eventDoc.body;

      event.pageX = event.clientX +
        (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
        (doc && doc.clientLeft || body && body.clientLeft || 0);
      event.pageY = event.clientY +
        (doc && doc.scrollTop || body && body.scrollTop || 0) -
        (doc && doc.clientTop || body && body.clientTop || 0);
    }
    // Use event.pageX / event.pageY here

    if (dragging) {
      cursorX = event.pageX
      cursorY = event.pageY
      /* Move element with the mouse so it looks like we drag it.. */
      document.getElementById('draggedItem').style.left = '' + cursorX - 50 + 'px';
      document.getElementById('draggedItem').style.top = '' + cursorY - 50 + 'px';
    }
  }

  window.addEventListener('message', function (event) {
    let item = event.data;
    // Trigger adding a new message to the log and create its display
    if (item.response == "openGui") {
      dateNow = Date.now()
      $("#UseBar").fadeOut(100);
      document.getElementById('wrapmain').innerHTML = "";
      document.getElementById('wrapsecondary').innerHTML = "";
      $("#app").fadeIn();
      $('#move-amount').focus();
    } else if (item.response == "closeGui") {
      $("#app").fadeOut();
    } else if (item.response == "updateQuality") {
      UpdateQuality(item)
    } else if (item.response == "Populate") {
      DisplayInventoryMultiple(item.playerinventory, item.itemCount, item.invName, item.targetinventory, item.targetitemCount, item.targetinvName, item.cash, item.StoreOwner, item.Shell);
    } else if (item.response == "PopulateSingle") {
      PersonalWeight = 0
      DisplayInventory(item.playerinventory, item.itemCount, item.invName, true)
    } else if (item.response == "cashUpdate") {
      userCash = item.amount
      brought = item.brought
      isCop = item.cop
    } else if (item.response == "DisableMouse") {
      clicking = false;
      EndDrag(slotusing);
      EndDrag(draggingid)
      dragging = false;
      draggingid = "none";
      document.getElementById('draggedItem').style.opacity = '0.0';
      document.getElementById('draggedItem').innerHTML = "";
    } else if (item.response == "EnableMouse") {
      clicking = true;
    } else if (item.response == "DisplayBar") {
      ToggleBar(item.toggle, item.boundItems, item.boundItemsAmmo)
    } else if (item.response == "UseBar") {
      UseBar(item.itemid, item.text, item.amount)
    } else if (item.response == "SendItemList") {
      itemList = item.list
    } else if (item.response == "GiveItemChecks") {
      if (itemList[item.id]) {
        $.post("http://erp-inventory/GiveItem", JSON.stringify([item.id, item.amount, item.generateInformation, true, itemList[item.id].nonStack, item.data, itemList[item.id].weight]));
      } else {
        $.post("http://erp-inventory/GiveItem", JSON.stringify([item.id, item.amount, item.generateInformation, false, false, item.data]));
      }
    }
  })
});



let usedBar = 0

function UpdateQuality(data, penis) {

  let inventory = data.inventory

  let divslot = 'secondaryslot' + data.slot
  if (inventory.indexOf("ply") > -1) {
    divslot = 'playerslot' + data.slot
  }

  let item = document.getElementById(divslot).getElementsByTagName('img')[0];


  let weight = parseInt(item.dataset.weight);

  let name = item.dataset.name;

  let itemcount = parseInt(item.dataset.amount);

  let itemid = item.dataset.itemid

  let image = itemList[itemid].image;

  let inventoryNumber = parseInt(item.dataset.inventory)

  let creationDate = parseInt(item.dataset.creationDate)

  let quality = ConvertQuality(itemid, data.creationDate)

  if (quality == undefined) {
    quality = 100
  }

  if (penis != undefined) {
    quality = penis
  }

  if (quality < 0) {
    quality = 0
  }

  let itemMaxed = "class='itemQuality'"

  if (quality == 100) { itemMaxed = "class='perfect'" }

  if (quality < 70) { itemMaxed = "class='middleQuality'" }

  let qualityWidth = quality

  if (quality == 0) {
    qualityWidth = 100
    itemMaxed = "class='destroyed"
  } else if (quality < 5) {
    qualityWidth = 100
    itemMaxed = "class='destroyed"
  } else if (quality < 10) {
    qualityWidth = 100
    itemMaxed = "class='destroyed"
  }

  info = JSON.stringify({}) //Dont forget about this 

  let meta = item.dataset.metainformation
  let item_cost = item.dataset.fwewef
  let slot = item.dataset.currentslot

  let nonStack = true
  let inventoryName = inventory

  if (name == 'Evidence') {
    meta = 'Obtained Evidence (needs to be traced)'
  }

  if (name == 'DNA Cotton Swab') {
    meta = 'Used Cotton Swab (trace)'
  }

  let htmlstring = "<div " + itemMaxed + " style='width:" + qualityWidth + "%'> " + " </div>  <div class='itemname'> " + name + " </div> <div class='information'>  " + itemcount + " (" + weight + ".00) </div>          <img draggable='false' src='icons/" + image + "' data-info='" + info + "' data-inventory='" + inventoryNumber + "' data-quality='" + quality + "' data-name='" + name + "' data-metainformation='" + meta + "' data-itemid='" + itemid + "' data-fwewef='" + item_cost + "' data-inventory='" + inventoryNumber + "' data-currentslot='" + slot + "' data-stackable='" + nonStack + "' data-amount='" + itemcount + "' data-weight='" + weight + "' data-inventoryname='" + inventoryName + "' class='itemimage'>";

  document.getElementById(divslot).innerHTML = htmlstring;

}

function RandomGen(length) {
  var result = '';
  var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  var charactersLength = characters.length;
  for (var i = 0; i < length; i++) {
    result += characters.charAt(Math.floor(Math.random() * charactersLength));
  }
  return result;
}

let fadeOut = 0


function UseBar(itemid, text, amount) {

  if (amount == undefined) { amount = 1 };

  let image = ""
  let name = ""
  let htmlstring = ""
  let id = RandomGen(10)
  fadeOut = id
  image = itemList[itemid].image;
  name = itemList[itemid].displayname;
  htmlstring = " <div class='item2' > <div class='UseBarHead'> " + text + " " + amount + "x  </div> <div class='itemname2'> " + name + " </div> <img draggable='false' src='icons/" + image + "' class='itemimage'>  </div>";

  var p = document.getElementById('UseBar');
  var newElement = document.createElement(id);
  newElement.setAttribute('id', id);
  newElement.innerHTML = htmlstring;
  p.prepend(newElement);

  $("#UseBar").fadeIn(1000);

  setTimeout(() => {
    $(newElement).fadeOut(500);
  }, 2500)

  setTimeout(() => {
    if (fadeOut == id) {
      $("#UseBar").fadeOut(350);
    }
    var element = document.getElementById(id);
    element.parentNode.removeChild(element);

  }, 3000)

}



function ToggleBar(toggle, boundItems, boundItemsAmmo) {
  if (toggle) {

    document.getElementById('ActionBar').innerHTML = "";

    let image = ""
    let name = ""
    let htmlstring = ""

    if (boundItems[1] && boundItems[1][0]) {
      image = itemList[boundItems[1][0]].image;
      name = itemList[boundItems[1][0]].displayname;


      htmlstring = "<div id='bind1'> 1 </div> <div class='item3' > <div class='itemname3'> " + name + " </div> <img draggable='false' src='icons/" + image + "' class='itemimage'>  </div>";
    } else {

      htmlstring = "<div id='bind1'> 1 </div> <div class='item3' > <div class='itemname3'> unbound </div> <img draggable='false' src='icons/empty.png' class='itemimage'>  </div>";
    }

    for (let i = 2; i < 5; i++) {

      if (boundItems[i] && boundItems[i][0]) {
        image = itemList[boundItems[i][0]].image;
        name = itemList[boundItems[i][0]].displayname;

        htmlstring = htmlstring + "<div id='bind" + i + "'> " + i + " </div><div class='item3' > <div class='itemname3'> " + name + " </div> <img draggable='false' src='icons/" + image + "' class='itemimage'>  </div>";
      } else {

        htmlstring = htmlstring + "<div id='bind" + i + "'> " + i + " </div><div class='item3' > <div class='itemname3'> unbound </div> <img draggable='false' src='icons/empty.png' class='itemimage'>  </div>";
      }

    }
    document.getElementById('ActionBar').innerHTML = htmlstring;

    $("#ActionBar").fadeIn(500);

  } else {
    $("#ActionBar").fadeOut(500);
  }
}

document.onkeyup = function (data) {
  if (data.which == 27) {
    closeInv()
  }
}

function invStack(targetSlot, moveAmount, targetInventory, originSlot, originInventory, purchase, itemCosts, itemidsent, amountmoving, crafting, weapon, amountRemaining) {
  let arr = [targetSlot, moveAmount, targetInventory, originSlot, originInventory, purchase, itemCosts, itemidsent, amountmoving, crafting, weapon, PlayerStore, amountRemaining];
  $.post("http://erp-inventory/stack", JSON.stringify(arr));
};

function invMove(targetSlot, originSlot, targetInventory, originInventory, purchase, itemCosts, itemidsent, amountmoving, crafting, weapon) {
  let arr = [targetSlot, originSlot, targetInventory, originInventory, purchase, itemCosts, itemidsent, amountmoving, crafting, weapon, PlayerStore];
  $.post("http://erp-inventory/move", JSON.stringify(arr));
  document.getElementById('search-text').value = "";
  searchUpdate();

};

function invSwap(targetSlot, targetInventory, originSlot, originInventory) {
  let arr = [targetSlot, targetInventory, originSlot, originInventory];
  $.post("http://erp-inventory/swap", JSON.stringify(arr));
};

function removeCraftItems(itemid, moveAmount) {
  let arr = itemList[itemid].craft
  let amount = moveAmount;
  $.post("http://erp-inventory/removeCraftItems", JSON.stringify([arr, amount]));
};

function CreateEmptyPersonalSlot(slotLimit) {
  for (i = 1; i < slotLimit + 1; i++) {

    let htmlstring = "<div id='playerslot" + i + "' class='item' > </div>"

    if (i == 1) {
      htmlstring = "<div id='playerslot" + i + "' class='item' > </div> <div id='bind1'> 1 </div> "
    } else if (i == 2) {
      htmlstring = "<div id='playerslot" + i + "' class='item' > </div> <div id='bind2'> 2 </div>  "
    } else if (i == 3) {
      htmlstring = "<div id='playerslot" + i + "' class='item' >  </div> <div id='bind3'> 3 </div> "
    } else if (i == 4) {
      htmlstring = "<div id='playerslot" + i + "' class='item' >  </div> <div id='bind4'> 4 </div> "
    }
    document.getElementById('wrapmain').innerHTML += htmlstring;
  }
}

function CreateEmptySecondarySlot(slotLimit) {
  let classColorName = "default";

  if (TargetInventoryName.indexOf("Glovebox") > -1) {
    classColorName = "lblue";
  } else if (TargetInventoryName.indexOf("Trunk") > -1) {
    classColorName = "lblue";
  } else if (TargetInventoryName.indexOf("hidden") > -1) {
    classColorName = "green";
  } else if (TargetInventoryName.indexOf("Drop") > -1) {
    classColorName = "red";
  }
  for (i = 1; i < slotLimit + 1; i++) {
    let htmlstring = "<div id='secondaryslot" + i + "' class='item " + classColorName + "' > </div>";
    document.getElementById('wrapsecondary').innerHTML += htmlstring;
  }
}

function isEmpty(obj) {
  for (let key in obj) {
    if (obj.hasOwnProperty(key))
      return false;
  }
  return true;
}

function InventoryLog(string) {
  document.getElementById('Logs').innerHTML = string + "<br>" + document.getElementById('Logs').innerHTML;
}

let PlayerInventoryName = "none";
let TargetInventoryName = "none";
let shop = "Shop";
let craft = "Craft";
let slotLimitTarget = 500000000000000;
let MyInventory = {}
let MyItemCount = 0
let StoreOwner = false
let PlayerStore = false

const HousingObjects = [
  {id: 90805875, weight: 650.0, slot: 150},
  {id: -1280437652, weight: 50.0, slot: 20},
  {id: -335877674, weight: 250.0, slot: 100},
  {id: 863314394, weight: 350.0, slot: 125},
  {id: 1725227610, weight: 300.0, slot: 100},
  {id: 914205402, weight: 300.0, slot: 100},
  {id: -301668442, weight: 525.0, slot: 125},
  {id: -586091884, weight: 650.0, slot: 140},
  {id: 1892623307, weight: 1000.0, slot: 175},
  {id: 306579620, weight: 200.0, slot: 75},
  {id: 309266674, weight: 250.0, slot: 100},
  {id: 658311972, weight: 425.0, slot: 100},
  {id: -1600421347, weight: 400.0, slot: 100},
  {id: -1003293747, weight: 50.0, slot: 25},
  {id: -599924401, weight: 200.0, slot: 75},
  {id: -1464134536, weight: 30.0, slot: 40},
  {id: 580175976, weight: 300.0, slot: 100},
  {id: -1251197000, weight: 100.0, slot: 40},
  {id: 1089807209, weight: 200.0, slot: 75},
  {id: -2094907124, weight: 150.0, slot: 50},
  {id: 250681399, weight: 125.0, slot: 50},
  {id: -994868291, weight: 125.0, slot: 50},
  {id: 1797500920, weight: 150.0, slot: 50},
  {id: -2008585441, weight: 150.0, slot: 50},
  {id: 1601487018, weight: 100.0, slot: 40},
  {id: -457079481, weight: 250.0, slot: 100},
  {id: 603696143, weight: 150.0, slot: 50},
]

const VehicleWeights = {
  // Classic Cars
  [838982985]: {weight: 100.0, slots: 10},
  [941800958]: {weight: 100.0, slots: 5},
  [-988501280]: {weight: 100.0, slots: 5},
  [223240013]: {weight: 150.0, slots: 10},
  [1011753235]: {weight: 100.0, slots: 10},
  [310284501]: {weight: 250.0, slots: 15},
  [1617472902]: {weight: 300.0, slots: 20},
  [-831834716]: {weight: 50.0, slots: 1},
  [-2079788230]: {weight: 150.0, slots: 5},
  [722226637]: {weight: 200.0, slots: 10},
  [-1405937764]: {weight: 150.0, slots: 5},
  [1051415893]: {weight: 100.0, slots: 5},
  [-1660945322]: {weight: 100.0, slots: 5},
  [1046206681]: {weight: 150.0, slots: 5},
  [-433375717]: {weight: 100.0, slots: 5},
  [-882629065]: {weight: 150.0, slots: 10},
  [1830407356]: {weight: 300.0, slots: 10},
  [-1804415708]: {weight: 250.0, slots: 10},
  [1107404867]: {weight: 200.0, slots: 5},
  [1078682497]: {weight: 200.0, slots: 10},
  [2049897956]: {Weight: 150.0, slots: 10},
  [1841130506]: {weight: 150.0, slots: 10},
  [2031587082]: {weight: 200.0, slots: 10},
  [117401876]: {weight: 150.0, slots: 5},
  [-602287871]: {weight: 150.0, slots: 5},
  [1545842587]: {weight: 200.0, slots: 10},
  [-2098947590]: {weight: 100.0, slots: 5},
  [-1566741232]: {weight: 200.0, slots: 10},
  [1504306544]: {weight: 50.0, slots: 1},
  [464687292]: {weight: 250.0, slots: 10},
  [-1797613329]: {weight: 250.0, slots: 5},
  [1531094468]: {weight: 250.0, slots: 5},
  [1762279763]: {weight: 200.0, slots: 10},
  [-1558399629]: {weight: 150.0, slots: 5},
  [-2033222435]: {weight: 200.0, slots: 10},
  [-982130927]: {weight: 100.0, slots: 1},
  [758895617]: {weight: 150.0, slots: 1},
  [1862507111]: {weight: 150.0, slots: 10},
  // Coupe Cars
  [330661258]: {weight: 150.0, slots: 10},
  [-5153954]: {weight: 150.0, slots: 5},
  [-591610296]: {weight: 200.0, slots: 10},
  [-391594584]: {weight: 200.0, slots: 15},
  [-89291282]: {weight: 150.0, slots: 10},
  [-624529134]: {weight: 150.0, slots: 10},
  [1348744438]: {weight: 200.0, slots: 10},
  [-511601230]: {weight: 250.0, slots: 15},
  [873639469]: {weight: 150.0, slots: 5},
  [1349725314]: {weight: 200.0, slots: 10},
  [1581459400]: {weight: 300.0, slots: 10},
  [-1930048799]: {weight: 250.0, slots: 5},
  [-1122289213]: {weight: 200.0, slots: 10},
  [-1193103848]: {weight: 150.0, slots: 5},
  // Offroad Cars
  [1126868326]: {weight: 100.0, slots: 1},
  [-349601129]: {weight: 50.0, slots: 1},
  [-2128233223]: {weight: 25.0, slots: 1},
  [-48031959]: {weight: 50.0, slots: 1},
  [-1269889662]: {weight: 25.0, slots: 1},
  [-440768424]: {weight: 25.0, slots: 1},
  [-1479664699]: {weight: 300.0, slots: 15},
  [-1435919434]: {weight: 350.0, slots: 20},
  [-1349095620]: {weight: 400.0, slots: 25},
  [1770332643]: {weight: 450.0, slots: 30},
  [-1237253773]: {weight: 400.0, slots: 20},
  [-1661854193]: {weight: 50.0, slots: 1},
  [-1756021720]: {weight: 450.0, slots: 25},
  [-54332285]: {weight: 300.0, slots: 10},
  [-2107990196]: {weight: 650.0, slots: 25},
  [-362150785]: {weight: 300.0, slots: 15},
  [92642664]: {weight: 250.0, slots: 10},
  [-121446169]: {weight: 300.0, slots: 15},
  [-2064372143]: {weight: 250.0, slots: 10},
  [408825843]: {weight: 50.0, slots: 1},
  [1645267888]: {weight: 300.0, slots: 15},
  [-1207771834]: {weight: 250.0, slots: 10},
  [-2045594037]: {weight: 300.0, slots: 15},
  [-1532697517]: {weight: 450.0, slots: 15},
  [-599568815]: {weight: 400.0, slots: 20},
  [-1189015600]: {weight: 450.0, slots: 20},
  [989381445]: {weight: 500.0, slots: 25},
  [101905590]: {weight: 50.0, slots: 1},
  [-663299102]: {weight: 50.0, slots: 1},
  [740289177]: {weight: 50.0, slots: 1},
  [67753863]: {weight: 300.0, slots: 15},
  // Super Cars
  [-1829802492]: {weight: 50.0, slots: 5 },
  [-1216765807]: {weight: 100.0, slots: 10},
  [-313185164]: {weight: 100.0, slots: 10},
  [633712403]: {weight: 100.0, slots: 10},
  [-16961406015]: {weight: 100.0, slots: 10},
  [-131154784]: {weight: 50.0, slots: 5},
  [1392481335]: {weight: 100.0, slots: 10},
  [1591739866]: {weight: 50.0, slots: 5},
  [1323778901]: {weight: 50.0, slots: 5},
  [819197656]: {weight:100.0, slots: 10},
  [-1291952903]: {weight: 100.0, slots: 10},
  [-2120700196]: {weight: 50.0, slots: 5},
  [1426219628]: {weight: 50.0, slots: 5},
  [960812448]: {weight: 50.0, slots: 5},
  [1234311532]: {weight: 50.0, slots: 5},
  [418536135]: {weight: 50.0, slots: 5},
  [-2048333973]: {weight: 50.0, slots: 5},
  [-482719877]: {weight: 50.0, slots: 5},
  [-664141241]: {weight: 50.0, slots: 5 },
  [1034187331]: {weight: 100.0, slots: 10},
  [1093792632]: {weight: 100.0, slots: 10},
  [19871428970]: {weight: 100.0, slots: 10},
  [-1758137366]: {weight: 100.0, slots: 10},
  [234062309]: {weight: 50.0, slots: 5},
  [-1232836011]: {weight: 50.0, slots: 5},
  [-324618589]: {weight: 50.0, slots: 5},
  [1352136073]: {weight: 100.0, slots: 10},
  [1663218586]: {weight: 100.0, slots: 10},
  [-1134706562]: {weight: 100.0, slots: 10},
  [272929391]: {weight: 50.0, slots: 5},
  [1031562256]: {weight: 50.0, slots: 5},
  [1044193113]: {weight: 50.0, slots: 5},
  [-1358197432]: {weight: 50.0, slots: 5},
  [408192225]: {weight: 50.0, slots: 5},
  [-376434238]: {weight: 50.0, slots: 5},
  [2067820283]: {weight: 50.0 , slots: 5},
  [338562499]: {weight: 50.0, slots: 5},
  [1939284556]: {weight: 50.0, slots: 5},
  [-998177792]: {weight: 100.0, slots: 10},
  [-1622444098]: {weight: 50.0, slots: 5},
  [2123327359]: {weight: 50.0, slots: 5},
  [917809321]: {weight: 50.0, slots: 5},
  [-140312855]: {weight: 50.0, slots: 5},
  [-682108547]: {weight: 50.0, slots: 5},
  // Compact Cars
  [1118611807]: {weight: 150.0, slots: 10},
  [-2098954619]: {weight: 100.0, slots: 10},
  [-344943009]: {weight: 150.0, slots: 10},
  [409049982]: {weight: 150.0, slots: 10},
  [1549126457]: {weight: 100.0, slots: 5},
  [-1130810103]: {weight: 200.0, slots: 15},
  [-1177863319]: {weight: 100.0, slots: 10},
  [931280609]: {weight: 50.0, slots: 5},
  [-431692672]: {weight: 50.0, slots: 5},
  [-1450650718]: {weight: 200.0, slots: 10},
  [841808271]: {weight: 150.0 , slots: 10},
  // Industrial
  [-1006919392]: {weight: 600.0, slots: 15},
  [1886712733]: {weight: 300.0, slots: 5},
  [-2130482718]: {weight: 3000.0, slots: 60},
  [-784816453]: {weight: 1000.0, slots: 40},
  [475220373]: {weight: 1000.0, slots: 40},
  [-1705304628]: {weight: 2000.0, slots: 50},
  [48339065]: {weight: 1000.0, slots: 25},
  [-947761570]: {weight: 1500.0, slots: 35},
  // Muscle Cars
  [2134119907]: {weight: 250.0, slots: 10},
  [-1205801634]: {weight: 250.0, slots: 15},
  [1069929536]: {weight: 450.0, slots: 25},
  [-1013450936]: {weight: 250.0, slots: 15},
  [-682211828]: {weight: 200.0, slots: 15},
  [349605904]: {weight: 200.0, slots: 15},
  [-1361687965]: {weight: 250.0, slots: 15},
  [-1566607184]: {weight: 200.0, slots: 10},
  [784565758]: {weight: 150.0, slots: 10},
  [1279262537]: {weight: 200.0, slots: 10},
  [80636076]: {weight: 150.0, slots: 10},
  [-915704871]: {weight: 150.0, slots: 5},
  [-986944621]: {weight: 200.0, slots: 10},
  [723973206]: {weight: 250.0, slots: 10},
  [1693751655]: {weight: 250.0, slots: 15},
  [-1267543371]: {weight: 150.0, slots: 10},
  [-2119578145]: {weight: 250.0, slots: 10},
  [-1790546981]: {weight: 250.0, slots: 5},
  [-2039755226]: {weight: 250.0, slots: 5},
  [-1800170043]: {weight: 250.0, slots: 10},
  [349315417]: {weight: 200.0, slots: 10},
  [1934384720]: {weight: 250.0, slots: 10},
  [-2122646867]: {weight: 250.0, slots: 5},
  [15219735]: {weight: 300.0, slots: 10},
  [37348240]: {weight: 100.0, slots: 5},
  [600450546]: {weight: 150.0, slots: 5},
  [-2096690334]: {weight: 200.0, slots: 10},
  [2068293287]: {weight: 300.0, slots: 5},
  [-2124201592]: {weight: 200.0, slots: 15},
  [1717532765]: {weight: 250.0, slots: 15},
  [525509695]: {weight: 350.0, slots: 20},
  [1896491931]: {weight: 400.0, slots: 15},
  [-1943285540]: {weight: 200.0, slots: 10},
  [-2095439403]: {weight: 250.0, slots: 10},
  [1507916787]: {weight: 300.0, slots: 20},
  [-667151410]: {weight: 450.0, slots: 25},
  [-589178377]: {weight: 400.0, slots: 20},
  [-227741703]: {weight: 200.0, slots: 10},
  [972671128]: {weight: 200.0, slots: 10},
  [1456744817]: {weight: 250.0, slots: 10},
  [-1685021548]: {weight: 200.0, slots: 10},
  [223258115]: {weight: 250.0, slots: 10},
  [729783779]: {weight: 400.0, slots: 20},
  [833469436]: {weight: 400.0, slots: 15},
  [1119641113]: {weight: 350.0, slots: 15},
  [1923400478]: {weight: 250.0, slots: 10},
  [-401643538]: {weight: 200.0, slots: 5},
  [-49115651]: {weight: 250.0, slots: 10},
  [-825837129]: {weight: 200.0, slots: 5},
  [-498054846]: {weight: 200.0,slots: 15},
  [-899509638]: {weight: 200.0, slots: 5},
  [16646064]: {weight: 200.0, slots: 10},
  [2006667053]: {weight: 250.0, slots: 10},
  [523724515]: {weight: 200.0, slots: 5},
  [1871995513]: {weight: 350.0, slots: 15},
  // Offroad Cars
  [1126868326]: {weight: 100.0, slots: 1},
  [-349601129]: {weight: 50.0, slots: 1},
  [-2128233223]: {weight: 25.0, slots: 1},
  [-48031959]: {weight: 50.0, slots: 1},
  [-1269889662]: {weight: 25.0, slots: 1},
  [-440768424]: {weight: 25.0, slots: 1},
  [-1479664699]: {weight: 300.0, slots: 15},
  [-1435919434]: {weight: 350.0, slots: 20},
  [-1349095620]: {weight: 400.0, slots: 25},
  [1770332643]: {weight: 450.0, slots: 30},
  [-1237253773]: {weight: 400.0, slots: 20},
  [-1661854193]: {weight: 50.0, slots: 1},
  [-1756021720]: {weight: 450.0, slots: 25},
  [-54332285]: {weight: 300.0, slots: 10},
  [-2107990196]: {weight: 650.0, slots: 25},
  [-362150785]: {weight: 300.0, slots: 15},
  [92642664]: {weight: 250.0, slots: 10},
  [-121446169]: {weight: 300.0, slots: 15},
  [-2064372143]: {weight: 250.0, slots: 10},
  [408825843]: {weight: 50.0, slots: 1},
  [1645267888]: {weight: 300.0, slots: 15},
  [-1207771834]: {weight: 250.0, slots: 10},
  [-2045594037]: {weight: 300.0, slots: 15},
  [-1532697517]: {weight: 450.0, slots: 15},
  [-599568815]: {weight: 400.0, slots: 20},
  [-1189015600]: {weight: 450.0, slots: 20},
  [989381445]: {weight: 500.0, slots: 25},
  [101905590]: {weight: 50.0, slots: 1},
  [-663299102]: {weight: 50.0, slots: 1},
  [740289177]: {weight: 50.0, slots: 1},
  [67753863]: {weight: 300.0, slots: 15},
  // Sports Cars
  [1032823388]: {weight: 200.0, slots: 10},
  [-1461482751]: {weight: 150.0, slots: 5},
  [686471183]: {weight: 250.0, slots: 10},
  [767087018]: {weight: 250.0, slots: 15},
  [-1041692462]: {weight: 200.0, slots: 5},
  [1274868363]: {weight: 300.0, slots: 15},
  [1039032026]: {weight: 200.0, slots: 10},
  [-591651781]: {weight: 200.0, slots: 10},
  [-304802106]: {wight: 200.0, slots: 10},
  [736902334]: {weight: 250.0, slots: 15},
  [2072687711]: {weight: 200.0, slots: 10},
  [-1045541610]: {weight: 200.0, slots: 5},
  [-2022483795]: {weight: 250.0, slots: 5},
  [661493923]: {weight: 250.0, slots: 10},
  [108773431]: {weight: 150.0, slots: 5},
  [-1728685474]: {weight: 200.0, slots: 5},
  [972671128]: {weight: 200.0, slots: 5},
  [196747873]: {weight: 200.0, slots: 5},
  [-566387422]: {weight: 250.0, slots: 10},
  [-1995326987]: {weight: 250.0, slots: 10},
  [-1259134696]: {weight: 250.0, slots: 5},
  [-1089039904]: {weight: 200.0, slots: 5},
  [499169875]: {weight: 250.0, slots: 15},
  [2016857647]: {weight: 150.0, slots: 5},
  [1909189272]: {weight: 50.0, slots: 1},
  [1115909093]: {weight: 50.0, slots: 1},
  [-1132721664]: {weight: 250.0, slots: 10},
  [1854776567]: {weight: 150.0, slots: 5},
  [-331467772]: {weight: 200.0, slots: 10},
  [-1297672541]: {weight: 200.0, slots: 5},
  [-214906006]: {weight: 150.0, slots: 5},
  [-208911803]: {weight: 250.0, slots: 15},
  [544021352]: {weight: 250.0, slots: 10},
  [-834353991]: {weight: 250.0, slots: 10},
  [-1372848492]: {weight: 250.0, slots: 10},
  [-941272559]: {weight: 100.0, slots: 5},
  [482197771]: {weight: 250.0, slots: 15},
  [-142942670]: {weight: 200.0, slots: 10},
  [-1620126302]: {weight: 200.0, slots: 10},
  [-1848994066]: {weight: 250, slots: 15},
  [-777172681]: {weight: 100.0, slots: 1},
  [-447711397]: {weight: 250.0, slots: 10},
  [867799010]: {weight: 200.0, slots: 10},
  [-377465520]: {weight: 250.0, slots: 10},
  [-631322662]: {weight: 250.0, slots: 15},
  [-1529242755]: {weight: 250.0, slots: 10},
  [-1934452204]: {weight: 250.0, slots: 5},
  [1737773231]: {weight: 200.0, slots: 5},
  [-674927303]: {weight: 50.0, slots: 1},
  [719660200]: {weight: 50.0, slots: 1},
  [-1485523546]: {weight: 250.0, slots: 10},
  [-507495760]: {weight: 200.0, slots: 10},
  [-746882698]: {weight: 200.0, slots: 10},
  [1349725314]: {weight: 200.0, slots: 10},
  [-1757836725]: {weight: 150.0, slots: 5},
  [1886268224]: {weight: 150.0, slots: 5},
  [1074745671]: {weight: 150.0, slots: 5},
  [987469656]: {weight: 300.0, slots: 15},
  [970598228]: {weight: 250.0, slots: 10},
  [872704284]: {weight: 200.0, slots: 10},
  [-295689028]: {weight: 200.0, slots: 5},
  [384071873]: {weight: 300.0, slots: 15},
  [1887331236]: {weight: 50.0, slots: 1},
  [1456336509]: {weight: 250.0, slots: 10},
  [1102544804]: {weight: 200.0, slots: 5},
  // Sedan Cars
  [-1809822327]: {weight: 250.0, slots: 10},
  [-1903012613]: {weight: 250.0, slots: 10},
  [906642318]: {weight: 250.0, slots: 10},
  [-2030171296]: {weight: 300.0, slots: 15},
  [-685276541]: {weight: 250.0, slots: 10},
  [-1883002148]: {weight: 200.0, slots: 5},
  [1909141499]: {weight: 250.0, slots: 10},
  [75131841]: {weight: 200.0, slots: 5},
  [-913589546]: {weight: 250.0, slots: 5},
  [-1289722222]: {weight: 300.0, slots: 15},
  [886934177]: {weight: 200.0, slots: 10},
  [-1883869285]: {weight: 200.0, slots: 5},
  [-1150599089]: {weight: 250.0, slots: 10},
  [-2040426790]: {weight: 250.0, slots: 5},
  [-14495224]: {weight: 350.0, slots: 15},
  [-1255452397]: {weight: 200.0, slots: 10},
  [1489967196]: {weight: 250.0, slots: 10},
  [321186144]: {weight: 200.0, slots: 10},
  [-1477580979]: {weight: 250.0, slots: 10},
  [1723137093]: {weight: 350.0, slots: 15},
  [1123216662]: {weight: 250.0, slots: 10},
  [-1894894188]: {weight: 250.0, slots: 10},
  [-1008861746]: {weight: 250.0, slots: 10},
  [1373123368]: {weight: 200.0, slots: 10},
  [1777363799]: {weight: 250.0, slots: 10},
  // SUV Cars
  [-808831384]: {weight: 350.0, slots: 10},
  [142944341]: {weight: 400.0, slots: 15},
  [1878062887]: {weight: 400.0, slots: 20},
  [634118882]: {weight: 400.0, slots: 25},
  [-16948145]: {weight: 500.0, slots: 25},
  [850865707]: {weight: 350.0, slots: 20},
  [-1987130134]: {weight: 550.0, slots: 30},
  [-233098306]: {weight: 550.0, slots: 30},
  [121658888]: {weight: 550.0, slots: 30},
  [444171386]: {weight: 550.0, slots: 30},
  [1876516712]: {weight: 800.0, slots: 40},
  [2006918058]: {weight: 350.0, slots: 10},
  [-789894171]: {weight: 400.0, slots: 20},
  [683047626]: {weight: 500.0, slots: 25},
  [1177543287]: {weight: 250.0, slots: 10},
  [-394074634]: {weight: 300.0, slots: 15},
  [1353720154]: {weight: 100.0, slots: 5},
  [-1137532101]: {weight: 300.0, slots: 15},
  [-1346687836]: {weight: 400.0, slots: 25},
  [296357396]: {weight: 400.0, slots: 25},
  [-1775728740]: {weight: 350.0, slots: 20},
  [-1543762099]: {weight: 350.0, slots: 20},
  [884422927]: {weight: 300.0, slots: 10},
  [486987393]: {weight: 400.0, slots: 20},
  [-120287622]: {weight: 500.0, slots: 25},
  [1269098716]: {weight: 350.0, slots: 15},
  [-838099166]: {weight: 450.0, slots: 20},
  [914654722]: {weight: 300.0, slots: 10},
  [-310465116]: {weight: 350.0, slots: 20},
  [-1126264336]: {weight: 350.0, slots: 10},
  [-1829436850]: {weight: 350.0, slots: 15},
  [1488164764]: {weight: 450.0, slots: 25},
  [-808457413]: {weight: 450.0, slots: 20},
  [-420911112]: {weight: 400.0, slots: 10},
  [-119658072]: {weight: 450.0, slots: 25},
  [943752001]: {weight: 450.0, slots: 25},
  [-1651067813]: {weight: 350.0, slots: 15},
  [83136452]: {weight: 400.0, slots: 20},
  [2136773105]: {weight: 400.0, slots: 15},
  [1162065741]: {weight: 500.0, slots: 25},
  [1221512915]: {weight: 300.0, slots: 15},
  [-1810806490]: {weight: 300.0, slots: 10},
  [1337041428]: {weight: 300.0, slots: 10},
  [-1961627517]: {weight: 300.0, slots: 10},
  [-810318068]: {weight: 450.0, slots: 25},
  [728614474]: {weight: 400.0, slots: 20},
  [1741861769]: {weight: 350.0, slots: 20},
  [699456151]: {weight: 500.0, slots: 30},
  [-1168952148]: {weight: 400.0, slots: 20},
  [1203490606]: {weight: 450.0, slots: 25},
  [65402552]: {weight: 500.0, slots: 25},
  [1026149675]: {weight: 450.0, slots: 20},
  [-1323100960]: {weight: 200.0, slots: 5},
  [-442313018]: {weight: 150.0, slots: 5},
  [-1700801569]: {weight: 1000.0, slots: 40},
  [1147287684]: {weight: 100.0, slots: 2},
  [-1178021069]: {weight: 50.0, slots: 1},

}

const ClassWeights = {
  [0]: {weight: 100.0, slots: 10}, // Compacts
  [1]: {weight: 250.0, slots: 10}, //  Sedans  
  [2]: {weight: 500.0, slots: 25}, // SUVs  
  [3]: {weight: 200.0, slots: 10}, // Coupes  
  [4]: {weight: 200.0, slots: 10}, // Muscle  
  [5]: {weight: 200.0, slots: 10}, // Sports Classics
  [6]: {weight: 200.0, slots: 10}, // Sports
  [7]: {weight: 100.0, slots: 5}, // Super
  [8]: {weight: 100.0, slots: 1}, // Motorcycle
  [9]: {weight: 300.0, slots: 20}, // Off-road
  [10]: {weight: 1000.0, slots: 30}, // Industrial
  [11]: {weight: 500.0, slots: 25}, // Utility
  [12]: {weight: 500.0, slots: 25}, // Vans
  [13]: {weight: 0.0, slots: 1}, // Cycles
  [14]: {weight: 100.0, slots: 5 }, // Boats
  [15]: {weight: 300.0, slots: 10 }, // Helicopters
  [16]: {weight: 300.0, slots: 20 }, // Planes
  [17]: {weight: 300.0, slots: 20 }, // Service
  [18]: {weight: 250.0, slots: 15 }, // Service
  [19]: {weight: 1000.0, slots: 10 }, // Military
  [20]: {weight: 500.0, slots: 30 }, // Commercial
  [21]: {weight: 500.0, slots: 30 }, // Trains
}


// weights are done here, based on the string of the inventory name
function DisplayInventoryMultiple(playerinventory, itemCount, invName, targetinventory, targetitemCount, targetinvName, cash, Owner, shell) {
  secondaryWeight = 0
  //StoreOwner = Owner
  PlayerStore = false
  userCash = parseInt(cash);

  DisplayInventory(playerinventory, itemCount, invName, true)
  MyInventory = playerinventory
  MyItemCount = itemCount

  SentShellType = "string"
  if (shell != "null") { SentShellType = typeof(shell) }
  
  if (SentShellType == "object" && shell) {
    const Model = shell['model']
    if (VehicleWeights[Model]) {
      secondaryMaxWeight = VehicleWeights[Model]['weight']
      slotLimitTarget = VehicleWeights[Model]['slots']
      console.log("Going for Model weight.")
    } else {
      const Class = shell['class']
      secondaryMaxWeight = ClassWeights[Class]['weight']
      slotLimitTarget = ClassWeights[Class]['slots']
      console.log("Going for Class weight.")
    }
  } else {
    if (targetinvName.indexOf("Drop") > -1) {
      secondaryMaxWeight = 1000.0
      slotLimitTarget = 30;
    } else if (targetinvName.indexOf("jobstash-jtenvy") > -1) {
      secondaryMaxWeight = 2000.0
      slotLimitTarget = 200;
    } else if (targetinvName.indexOf("PlayerStore") > -1) {
      secondaryMaxWeight = 1000.0
      slotLimitTarget = 2;
      PlayerStore = true;
    } else if (targetinvName.indexOf("storage") > -1) {
      secondaryMaxWeight = 2000.0
      slotLimitTarget = 200;
    } else if (targetinvName.indexOf("tasking") > -1) {
      secondaryMaxWeight = 200.0
      slotLimitTarget = 5;
    } else if (targetinvName.includes("ems-security")) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("jobstash") > -1) {
      secondaryMaxWeight = 800.0
      slotLimitTarget = 200;
    } else if (targetinvName.indexOf("securewarehouse1") > -1) {
      secondaryMaxWeight = 2500.0
      slotLimitTarget = 100;
    } else if (targetinvName.indexOf("securewarehouse2") > -1) {
      secondaryMaxWeight = 3500.0
      slotLimitTarget = 100;
    } else if (targetinvName.indexOf("Shop") > -1) {
      secondaryMaxWeight = 1500.0
      slotLimitTarget = 40;
    } else if (targetinvName.indexOf("house") > -1) {
      secondaryMaxWeight = 1000.0
      slotLimitTarget = 70;
    } else if (targetinvName.indexOf("motel1") > -1) {
      secondaryMaxWeight = 500.0
      slotLimitTarget = 30;
    } else if (targetinvName.indexOf("motel2") > -1) {
      secondaryMaxWeight = 750.0
      slotLimitTarget = 50;
    } else if (targetinvName.indexOf("motel3") > -1) {
      secondaryMaxWeight = 1000.0
      slotLimitTarget = 90;
    } else if (targetinvName.indexOf("Glovebox") > -1) {
      secondaryMaxWeight = 50.0
      slotLimitTarget = 5;
    } else if (targetinvName.indexOf("Seat") > -1) {
      secondaryMaxWeight = 10.0
      slotLimitTarget = 1;
    } else if (targetinvName.indexOf("Trunk") > -1) {
      secondaryMaxWeight = 500.0
      slotLimitTarget = 65;
    } else if (targetinvName.indexOf("Craft") > -1) {
      slotLimitTarget = 50;
    } else if (targetinvName.indexOf("hidden") > -1) {
      secondaryMaxWeight = 2000.0
      slotLimitTarget = 200;
    } else if (targetinvName.indexOf("evidence") > -1) {
      secondaryMaxWeight = 4000.0
      slotLimitTarget = 400;
    } else if (targetinvName.indexOf("Case") > -1) {
      secondaryMaxWeight = 4000.0
      slotLimitTarget = 400;
    } else if (targetinvName.indexOf("docks") > -1) {
      secondaryMaxWeight = 20000.0
      slotLimitTarget = 2000;
    } else if (targetinvName.indexOf("missionrow") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("sheriffstation") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("prison-stash") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("sapr-stash") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("trash") > -1) {
      secondaryMaxWeight = 4000.0
      slotLimitTarget = 400;
    } else if (targetinvName.indexOf("personal") > -1) {
      secondaryMaxWeight = 250.0
      slotLimitTarget = 5;
    } else if (targetinvName.indexOf("pillbox") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("cmmc") > -1) {
      secondaryMaxWeight = 10000.0
      slotLimitTarget = 250;
    } else if (targetinvName.indexOf("rack") > -1) {
      secondaryMaxWeight = 30.0
      slotLimitTarget = 3;
    } else {
      secondaryMaxWeight = 250.0
      slotLimitTarget = 40;
    }
  }

 

  for (i = 0; i < HousingObjects.length; i++) {
    if (targetinvName.indexOf(HousingObjects[i].id) > -1) {
      secondaryMaxWeight = HousingObjects[i].weight;
      slotLimitTarget = HousingObjects[i].slot;
    }
  }

  /**if (shell === 0) {
    secondaryMaxWeight = 100.0
    slotLimitTarget = 30;
  } else if (shell === 1) {
    secondaryMaxWeight = 150.0
    slotLimitTarget = 50;
  } else if (shell === 2) {
    secondaryMaxWeight = 300.0
    slotLimitTarget = 75;
  } else if (shell === 3) {
    secondaryMaxWeight = 150.0
    slotLimitTarget = 50;
  } else if (shell === 4) {
    secondaryMaxWeight = 75.0
    slotLimitTarget = 25;
  } else if (shell === 5) {
    secondaryMaxWeight = 75.0
    slotLimitTarget = 25;
  } else if (shell === 6) {
    secondaryMaxWeight = 75.0
    slotLimitTarget = 25;
  } else if (shell === 7) {
    secondaryMaxWeight = 25.0
    slotLimitTarget = 10;
  } else if (shell === 8) {
    secondaryMaxWeight = 50.0
    slotLimitTarget = 25;
  } else if (shell === 9) {
    secondaryMaxWeight = 500.0
    slotLimitTarget = 30;
  } else if (shell === 10) {
    secondaryMaxWeight = 300.0
    slotLimitTarget = 75;
  } else if (shell === 11) {
    secondaryMaxWeight = 350.0
    slotLimitTarget = 75;
  } else if (shell === 12) {
    secondaryMaxWeight = 350.0
    slotLimitTarget = 75;
  } else if (shell === 13) {
    secondaryMaxWeight = 1.0
    slotLimitTarget = 1;
  } else if (shell === 14) {
    secondaryMaxWeight = 50.0
    slotLimitTarget = 5;
  } else if (shell === 15) {
    secondaryMaxWeight = 20.0
    slotLimitTarget = 5;
  } else if (shell === 16) {
    secondaryMaxWeight = 20.0
    slotLimitTarget = 5;
  } else if (shell === 17) {
    secondaryMaxWeight = 300.0
    slotLimitTarget = 75;
  } else if (shell === 18) {
    secondaryMaxWeight = 250.0
    slotLimitTarget = 75;
  } else if (shell === 19) {
    secondaryMaxWeight = 400.0
    slotLimitTarget = 100;
  } else if (shell === 20) {
    secondaryMaxWeight = 1.0
    slotLimitTarget = 1;
  } else if (shell === 21) {
    secondaryMaxWeight = 1.0
    slotLimitTarget = 1;
  }  */
  
  InventoryLog(targetinvName + " | " + invName)
  DisplayInventory(targetinventory, targetitemCount, targetinvName, false)
}

function BuildDrop(brokenSlots) {
  $.post("http://erp-inventory/dropIncorrectItems", JSON.stringify({
    slots: brokenSlots
  }));
}

function produceInfo(data) {
  let string = ""
  let info = JSON.parse(data.replace(/"{/g, `{`).replace(/}"/g, `}`))

  for (let [key, value] of Object.entries(info)) {
    if (typeof value != 'object') {
      string = string + key + ": " + value + " | "
    }
  }

  return string.replace(/[ | ](?=[^|]*$)/, '');
}

function DisplayInventory(sqlInventory, itemCount, invName, main) {


  clicking = false
  sqlInventory = JSON.parse(sqlInventory)
  let maxWeight = 250
  let slotLimit = 40


  let inventory = {}
  itemCount = parseInt(itemCount);


  if (main) {
    personalWeight = 0
    PlayerInventoryName = invName;
    CreateEmptyPersonalSlot(slotLimit)
  } else {
    TargetInventoryName = invName;
    CreateEmptySecondarySlot(slotLimitTarget)
    slotLimit = slotLimitTarget
  }
  let slot = 0;

  InventoryLog(invName + " is Loading.")

  let inventoryNumber = 1;

  if (!main) {
    inventoryNumber = 2;
  }

  let failure = false;
  let fixSlots = {};

  for (i in sqlInventory) {
    slot = sqlInventory[i].slot

    if (isEmpty(inventory[slot])) {
      // do something 
      inventory[slot] = {}
      inventory[slot].slot = slot
      inventory[slot].itemid = sqlInventory[i].item_id
      inventory[slot].itemcount = sqlInventory[i].amount
      inventory[slot].inventoryName = sqlInventory[i].name
      inventory[slot].information = sqlInventory[i].information
      inventory[slot].creationDate = sqlInventory[i].creationDate
      inventory[slot].quality = sqlInventory[i].quality
      inventory[slot].price = sqlInventory[i].price
      inventory[slot].grade = sqlInventory[i].grade

    } else {
      if (sqlInventory[i].item_id != inventory[slot].itemid) {
        if (!fixSlots[invName])
          fixSlots[invName] = []
        failure = true
        fixSlots[invName].push({
          faultySlot: slot,
          faultyItem: sqlInventory[i].item_id
        });

      } else {
        inventory[slot].itemcount = inventory[slot].itemcount + 1

      }
    }
  }

  if (failure) {
    BuildDrop(fixSlots)
    closeInv()
  }

  let inventoryName = invName

  if (inventoryName == "Craft") {
    crafting = true
  }

  if (itemCount != 0) {
    inventoryName = " Error grabbing item names."
  }

  for (i = 0; i < slotLimit + 1; i++) {

    if (isEmpty(inventory[i])) {

    } else {

      let slot = inventory[i].slot;

      let itemid = "" + inventory[i].itemid + "";

      if (itemList[itemid] !== undefined) {


        let itemcount = inventory[i].itemcount;

        if (invName.indexOf("steam") > -1) {

          inventoryName = invName
        }
        else {

          inventoryName = inventory[slot].inventoryName
        }





        let weight = itemList[itemid].weight;
        let item_cost = inventory[i].price;
        let jobgrade = inventory[i].grade || null;


        let nonStack = itemList[itemid].nonStack;
        let image = itemList[itemid].image;

        let name = itemList[itemid].displayname;

        let meta = JSON.stringify(inventory[i].information);
        let creationDate = inventory[i].creationDate;

        let info = meta;

        if (meta == undefined) {
          meta = ""
        }

        let quality = inventory[i].quality

        if (itemList[itemid].information) {
          meta = meta + "<br>" + itemList[itemid].information

          if (itemList[itemid].craft !== undefined && !main && invName.indexOf("Craft") > -1) {

            let requirements = itemList[itemid].craft;

            for (let xx = 0; xx < requirements.length; xx++) {
              meta = meta + "<br>" + itemList[requirements[xx].itemid].displayname + ": " + requirements[xx].amount
            }
          }
        } else {

          if (itemList[itemid].craft !== undefined && !main && invName.indexOf("Craft") > -1) {

            let requirements = itemList[itemid].craft;

            for (let xx = 0; xx < requirements.length; xx++) {
              meta = meta + "<br>" + itemList[requirements[xx].itemid].displayname + ": " + requirements[xx].amount
            }
          }
        }

        let stackString = "(nS)"
        if (nonStack) {
          nonStack = 1
        } else {
          nonStack = 0
          stackString = "(S)"
        }

        if (quality == undefined) { quality = 100 }

        let qualityWidth = quality

        let itemMaxed = "class='itemQuality'"

        if (quality < 70) { itemMaxed = "class='middleQuality'" }

        if (quality == 0) {
          qualityWidth = 100
          itemMaxed = "class='destroyed"
        } else if (quality < 5) {
          qualityWidth = 100
          itemMaxed = "class='destroyed"
        } else if (quality < 10) {
          qualityWidth = 100
          itemMaxed = "class='destroyed"
        }

        if (name == 'Evidence') {
          if (meta.substr(4, 10) == 'Identifier') {
            meta = 'Obtained Evidence (' + meta.substr(19, 11) + ')'
          }
        }


        if (name == 'DNA Cotton Swab') {
          if (meta.includes("CID")) {
            meta = meta
          } else {
            meta = 'Unused Cotton Swab'
          }

        }

        let htmlstring = "<div " + itemMaxed + " style='width:" + qualityWidth + "%'> " + " </div> <div class='itemname'> " + name + " </div> <div class='information'>  " + itemcount + " (" + weight + ".00) </div>          <img src='icons/" + image + "' data-inventory='" + inventoryNumber + "' data-quality='" + quality + "' data-creationDate='" + creationDate + "' data-name='" + name + "' data-info='" + info + "' data-metainformation='" + meta + "' data-itemid='" + itemid + "' data-fwewef='" + item_cost + "' data-inventory='1' data-currentslot='" + slot + "' data-stackable='" + nonStack + "' data-amount='" + itemcount + "' data-weight='" + weight + "' data-inventoryname='" + inventoryName + "' class='itemimage'>";

        if (TargetInventoryName == "Shop" && main === false) {
          htmlstring = "<div class='itemQuality' " + itemMaxed + " style='width:" + qualityWidth + "%'> " + " </div> <div class='itemname'> " + name + " - $" + item_cost + " </div> <div class='information'>  " + itemcount + " (" + weight + ".00) </div>          <img src='icons/" + image + "' data-inventory='" + inventoryNumber + "' data-creationDate='" + creationDate + "' data-quality='" + quality + "' data-name='" + name + "' data-info='" + info + "' data-metainformation='" + meta + "' data-fwewef='" + item_cost + "' data-itemid='" + itemid + "' data-inventory='2' data-currentslot='" + slot + "' data-stackable='" + nonStack + "' data-amount='" + itemcount + "' data-weight='" + weight + "' data-inventoryname='" + inventoryName + "' class='itemimage'>";
        }

        if ((!StoreOwner && PlayerStore && main === false)) {
          htmlstring = "<div class='itemQuality' " + itemMaxed + " style='width:" + qualityWidth + "%'> " + " </div> <div class='itemname'> " + name + " - $" + item_cost + " </div> <div class='information'>  " + itemcount + " (" + weight + ".00) </div>          <img src='icons/" + image + "' data-inventory='" + inventoryNumber + "' data-creationDate='" + creationDate + "' data-quality='" + quality + "' data-name='" + name + "' data-info='" + info + "' data-metainformation='" + meta + "' data-fwewef='" + item_cost + "' data-itemid='" + itemid + "' data-inventory='2' data-currentslot='" + slot + "' data-stackable='" + nonStack + "' data-amount='" + itemcount + "' data-weight='" + weight + "' data-inventoryname='" + inventoryName + "' class='itemimage'>";
        }

        if (TargetInventoryName == "Craft" && main === false) {
          if (sqlInventory[i - 1].amount === undefined) {
            itemcount = 1
          } else {
            itemcount = sqlInventory[i - 1].amount
          }
          htmlstring = "<div class='itemQuality' " + itemMaxed + " style='width:" + qualityWidth + "%'> " + " </div> <div class='itemname'> " + name + " </div> <div class='information'>  " + itemcount + " (" + weight + ".00) </div>          <img src='icons/" + image + "' data-inventory='" + inventoryNumber + "' data-creationDate='" + creationDate + "' data-quality='" + quality + "' data-name='" + name + "' data-info='" + info + "' data-metainformation='" + meta + "' data-fwewef='" + item_cost + "' data-itemid='" + itemid + "' data-inventory='2' data-currentslot='" + slot + "' data-stackable='" + nonStack + "' data-amount='" + itemcount + "' data-weight='" + weight + "' data-inventoryname='" + inventoryName + "' class='itemimage'>";
        }

        if (main) {
          document.getElementById('playerslot' + slot).innerHTML = htmlstring;

          personalWeight = personalWeight + (weight * itemcount)


        } else {
          if (slot != 0) {
            document.getElementById('secondaryslot' + slot).innerHTML = htmlstring;

            secondaryWeight = secondaryWeight + (weight * itemcount)
          }

        }
      }

    }

  }

  InventoryLog("Loaded " + inventoryName + " without recorded Error.")
  UpdateSetWeights()
  clicking = true
}



const TimeAllowed = 1000 * 60 * 40320; // 28 days, 

function ConvertQuality(itemID, creationDate) {
  let StartDate = new Date(creationDate).getTime()
  let DecayRate = itemList[itemID].decayrate
  let TimeExtra = (TimeAllowed * DecayRate)
  let percentDone = 100 - Math.ceil((((dateNow - StartDate) / TimeExtra) * 100))

  if (DecayRate == 0.0) { percentDone = 100 }
  if (percentDone < 0) { percentDone = 0 }
  return percentDone
}





function UpdateSetWeights() {
  document.getElementById('wrapPersonalWeight').innerHTML = "<h2>" + PlayerInventoryName;
  document.getElementById('wrapSecondaryWeight').innerHTML = "<h2>" + TargetInventoryName;

  document.getElementById('wrapPersonalWeight1').innerHTML = "<h2>" + " </h2> Weight: " + personalWeight.toFixed(2) + " / " + personalMaxWeight.toFixed(2);
  document.getElementById('wrapSecondaryWeight1').innerHTML = "<h2>" + " </h2> Weight: " + secondaryWeight.toFixed(2) + " / " + secondaryMaxWeight.toFixed(2);

  let meh = personalWeight.toFixed(2)
  $.post("http://erp-inventory/Weight", JSON.stringify({
    weight: meh
  }));
}

document.onmousedown = function (eventHandler, mEvent) {
  let x = event.clientX,
    y = event.clientY,
    element = document.elementFromPoint(x, y);

  if (element.id === "CurrentInformation" || element.id === "Logs" || element.id === "wrapPersonalWeight" || element.id === "wrapSecondaryWeight" || element.id === "wrapmain" || element.id === "wrapsecondary") {
    return;
  }

  if (element.id === "CloseInv") {
    closeInv()
    return;
  } else if (element.id === "Use") {
    useitem();
  } else if (element.id === "Drop") {
    if (draggingid != "none") {
      AttemptDropInEmptySlot(draggingid, true);
    }
  }

  let isImg = (element.nodeName.toLowerCase() === 'img');

  if (isImg == true) {
    element = element.parentNode.id;
    DisplayInformation(element);

    if (eventHandler.which === 2) {
      DragToggle(element, true);
      useitem();
      return
    } else {
      DragToggle(element, false);
    }



  } else {
    DragToggle(element.id, false);
  }
}

document.onmouseover = function (e) {
  element = e.target;

  let isImg = (element.nodeName.toLowerCase() === 'img');

  if (isImg == true && !dragging) {
    element = element.parentNode.id;
    DisplayInformation(element);
    document.getElementById('CurrentInformation').style.opacity = '1';
  } else {

    if (!dragging) {
      document.getElementById('CurrentInformation').style.opacity = '0';
    }

  }
};

function DragToggle(slot, using) {

  let moveAmount = parseInt(document.getElementById("move-amount").value);

  if (!moveAmount) {
    if (TargetInventoryName == "Shop" || TargetInventoryName == "Player" || TargetInventoryName.indexOf("Craft") > -1 || PlayerStore || TargetInventoryName.indexOf("Shop") > -1) {
      document.getElementById("move-amount").value = 1;
      moveAmount = 1;
    } else {
      document.getElementById("move-amount").value = 0;
      moveAmount = 0;
    }
  }


  if (slot) {
    /* draggingid = Current dragged element(if dragging), slot = what we are attempting to drop in or pick up from */
    /* Here we confirm that the image exists that holds the information for the item(s). */
    let c = document.getElementById(slot).children.length;

    let occupiedslot = false;
    if (c > 0) {
      /* Here we declare if there is already an item in the slot we are dragging too by checking if there is an existing child node. */
      occupiedslot = true;
    }
    if (occupiedslot == true && dragging == false) {
      /* We are declaring that we just clicked our mouse button and are dragging a new object here. */



      dragging = true;
      draggingid = slot;

      $.post("http://erp-inventory/SlotInuse", JSON.stringify(parseInt(draggingid.replace(/\D/g, ''))));

      startCSSDrag();
      if (shiftHeld == true && !using) {
        FindEmptySlotAndMove(true)
      } else if (CtrlHeld == true && !using) {
        FindEmptySlotAndMove(false)
      }



    } else if (occupiedslot == true && dragging == true && !using) {
      /* Here we are trying to drop an item in an already filled slot, so, we swap the item current. */
      /* We will need to do a check to see if the item is the same, if its stackable and if so, we stack the item on top of the current stack and do not replace.. */
      AttemptDropInFilledSlot(slot);
    } else if (occupiedslot == false && dragging == true && !using) {
      $.post("http://erp-inventory/SlotInuse", JSON.stringify(parseInt(draggingid.replace(/\D/g, ''))));
      /* Here we are droping an item to an open slot - I guess we should check waits etc to confirm this is allowed before doing so. */
      AttemptDropInEmptySlot(slot, false);
    } else if (occupiedslot == false && dragging == false && !using) {
      /* I guess we reset here?. */
      dragging = false;
      draggingid = "none";
    }
  }
}


function FindEmptySlotAndMove(half) {
  let clickedInventory = document.getElementById(draggingid).parentElement.className;;
  let moveToSlotName = "playerslot";
  let slotCounter = 40
  if (clickedInventory == "wrapmain") {
    moveToSlotName = "secondaryslot";
    slotCounter = slotLimitTarget
  }

  for (let i = 1; i < slotCounter; i++) {
    let foundSlot = moveToSlotName + i
    let c = document.getElementById(foundSlot).children.length;
    if (c == 0) {
      $.post("http://erp-inventory/SlotInuse", JSON.stringify(parseInt(draggingid.replace(/\D/g, ''))));
      AttemptDropInEmptySlot(foundSlot, false, half);
      return
      // EndDragging(foundSlot)
    }
  }
  //EndDragging(draggingid)
}




function startCSSDrag() {
  let draggedItemHtml = document.getElementById(draggingid).innerHTML;
  document.getElementById('draggedItem').innerHTML = draggedItemHtml;
  document.getElementById('draggedItem').style.left = 'cursorX-50';
  document.getElementById('draggedItem').style.top = 'cursorY-50';
  document.getElementById('draggedItem').style.opacity = '0.5';
  //document.getElementById('draggedItem').fadeIn(200); 
}


function searchUpdate() {
  let searchInput = $("#search-text").val();


  $(".wrapmain").find("div[class*='itemname']").each(function (i, el) {

    let parent = el.parentElement.id;
    // this is grey
    document.getElementById(parent).style.backgroundColor = 'rgba(40,20,40,0.1)';

    curGPSLength = searchInput.length
    let dataSearched = el.innerHTML;
    let reg = new RegExp('(.*)' + searchInput + '(.*)', 'ig');

    if (reg.test(dataSearched) && searchInput != "") {        // this is green
      document.getElementById(parent).style.backgroundColor = 'rgba(40,110,40,0.5)';
    }

  });
  // this will need converting to search proper.
  searchInput = document.getElementById("search-text").value;
  $(".wrapsecondary").find("div[class*='itemname']").each(function (i, el) {

    let parent = el.parentElement.id;       // this is grey
    $("#" + parent).css('background-color', 'rgba(40,20,40,0.1)');
    curGPSLength = searchInput.length
    let dataSearched = el.innerHTML;
    let reg = new RegExp('(.*)' + searchInput + '(.*)', 'ig');

    if (reg.test(dataSearched) && searchInput != "") {// this is green
      $("#" + parent).css('background-color', 'rgba(40,110,40,0.5)');
    }

  });

}

function ErrorCheck(startingInventory, inventoryDropName, movementWeight) {

  let sameInventory = true;
  let ErrorReason = "Success"

  if (inventoryDropName == "wrapsecondary" && startingInventory == 1) {
    sameInventory = false;
    //InventoryLog("We are moving an item from Player to Secondary")
  } else if (inventoryDropName == "wrapmain" && startingInventory == 2) {
    sameInventory = false;
    //InventoryLog("We are moving an item from Secondary to Primary")
  }

  if (sameInventory == true) {
    if (startingInventory == 1) {
      // InventoryLog("We are moving stuff in our personal inventory.")
    } else {
      // InventoryLog("We are moving stuff in our secondary inventory.")
    }
  } else {
    // logging the weight changes.

    if (startingInventory == 1) {
      if (movementWeight + secondaryWeight > secondaryMaxWeight) {
        ErrorReason = "Your target weight is too much.";
      }
    } else {
      if (movementWeight + personalWeight > personalMaxWeight) {
        ErrorReason = "The personal weight is too much.";
      }
    }
  }
  return ErrorReason
}

function UpdateTextInformation(slot) {
  if (document.getElementById(slot)) {
    let item = document.getElementById(slot).getElementsByTagName('img')[0];
    if (item) {
      let informationDiv = document.getElementById(slot).getElementsByTagName('div')[2];
      let weight = parseInt(item.dataset.weight);
      let amount = parseInt(item.dataset.amount);
      let stackable = parseInt(item.dataset.stackable);
      if (parseInt(stackable) == 0) {
        stackable = "(S)"
      } else {
        stackable = "(nS)"
      }
      informationDiv.innerHTML = amount + " (" + weight + ".00)";
      // "..itemcount.."x ("..weight..") " .. stackString .. "
    }
  }
}

function DropItem(slot, amountDropped) {
  let item = document.getElementById(slot).getElementsByTagName('img')[0];
  currentInventory = item.dataset.inventory;
  weight = item.dataset.weight;
  amount = item.dataset.amount;

  name = item.dataset.name;
  itemid = item.dataset.itemid;
  inventoryUsedName = item.dataset.inventoryname;
  slotusing = item.dataset.currentslot;

  let inventoryUsedNameText = "Secondary Inventory"
  if (currentInventory == 1) {
    inventoryUsedNameText = "Player Inventory"
  }

  InventoryLog("Dropped: " + name + " x(" + amountDropped + ") from slot " + slotusing + " of " + inventoryUsedNameText)

  //$.post('http://erp-inventory/dropitem', JSON.stringify({
  // currentInventory: currentInventory,
  // weight: weight,
  // amount: amount,
  // name: name,
  // itemid: itemid,
  // inventoryUsedName: item.dataset.inventoryname,
  // slotusing: slotusing,
  // amountDropped: amountDropped,
  //}));

}

function ErrorMove() {
  $.post('http://erp-inventory/move:fail', JSON.stringify({}));
}

function SuccessMove() {
  $.post('http://erp-inventory/move:success', JSON.stringify({}));
}

// we are splitting items from inv2,slot2,amount2 over to inv1,slot1,amount1
// if amount2 is zero, we moved the entire stack.
//Should create item check qualities so that items with less quality cant be added to items of higher quality.
function CompileStacks(targetSlot, originSlot, inv1, inv2, originAmount, remainingAmount, targetAmount, purchase, itemCosts, itemidsent, moveAmount) {
  let penis = false

  if (TargetInventoryName == PlayerInventoryName) {
    penis = true;
  }

  $.post("http://erp-inventory/SlotJustUsed", JSON.stringify({
    targetslot: targetSlot,
    origin: originSlot,
    itemid: itemidsent,
    move: false,
    MyInvMove: penis
  }));

  if (inv2 == "wrapmain") {
    originInventory = PlayerInventoryName
  } else {
    originInventory = TargetInventoryName
  }

  if (inv1 == "wrapmain") {
    targetInventory = PlayerInventoryName
  } else {
    targetInventory = TargetInventoryName
  }

  var isWeapon = false
  if (itemList[itemidsent].weapon != null && !exluded[itemidsent] && !isCop) {
    brought = true
    isWeapon = itemList[itemidsent].weapon
  }

  invStack(targetSlot, moveAmount, targetInventory, originSlot, originInventory, purchase, itemCosts, itemidsent, moveAmount, crafting, isWeapon, remainingAmount);


  InventoryLog("Changed Slot: " + originSlot + "(" + originAmount + ") of " + inv1 + " to " + targetSlot + "(" + targetAmount + ") of " + inv2 + " ")
  UpdateSetWeights()
  if (crafting) {
    removeCraftItems(itemidsent, moveAmount)
    closeInv()
  }
}

function MoveStack(targetSlot, originSlot, inv1, inv2, purchase, itemCosts, itemidsent, moveAmount) {
  let myInv = false
  if (TargetInventoryName == PlayerInventoryName) {
    myInv = true;
  }

  $.post("http://erp-inventory/SlotJustUsed", JSON.stringify({
    targetslot: targetSlot,
    origin: originSlot,
    itemid: itemidsent,
    move: true,
    MyInvMove: myInv
  }));

  if (inv2 == "wrapmain") {
    originInventory = PlayerInventoryName
  } else {
    originInventory = TargetInventoryName
  }

  if (inv1 == "wrapmain") {
    targetInventory = PlayerInventoryName
  } else {
    targetInventory = TargetInventoryName
  }

  var isWeapon = false
  if (itemList[itemidsent].weapon != null && !exluded[itemidsent]) {
    brought = true
    isWeapon = itemList[itemidsent].weapon
  }

  invMove(targetSlot, originSlot, targetInventory, originInventory, purchase, itemCosts, itemidsent, moveAmount, crafting, isWeapon);

  InventoryLog("Moved Slot " + originSlot + " of " + originInventory + " to " + targetSlot + " of " + targetInventory + " #" + itemidsent)
  UpdateSetWeights()
  if (crafting) {
    removeCraftItems(itemidsent, moveAmount)
    closeInv()
  }
}

function SwapStacks(targetSlot, originSlot, inv1, inv2) {
  // $.post('http://erp-inventory/swapstack', JSON.stringify({
  //   slot1: slot1,
  //   slot2: slot2,
  //   inv1: inv1,
  //   inv2: inv2,
  // }));

  let penis = false
  if (TargetInventoryName == PlayerInventoryName) {
    penis = true;
  }

  RequestItemData()
  $.post("http://erp-inventory/SlotJustUsed", JSON.stringify({
    targetslot: targetSlot,
    origin: originSlot,
    itemid: itemid,
    move: false,
    MyInvMove: penis
  }));

  if (inv2 == "wrapmain") {
    originInventory = PlayerInventoryName
  } else {
    originInventory = TargetInventoryName
  }

  if (inv1 == "wrapmain") {
    targetInventory = PlayerInventoryName
  } else {
    targetInventory = TargetInventoryName
  }

  invSwap(targetSlot, targetInventory, originSlot, originInventory);

  InventoryLog("Swapped Slot " + originSlot + " of " + originInventory + " and " + targetSlot + " of " + targetInventory + " ")
  UpdateSetWeights()
}


function closeInv(pIsItemUsed = false) {
  personalWeight = 0;
  secondaryWeight = 0;

  $.post("http://erp-inventory/ServerCloseInventory", JSON.stringify({
    name: TargetInventoryName
  }));
  TargetInventoryName = "none";
  $.post("http://erp-inventory/Close", JSON.stringify({
    isItemUsed: pIsItemUsed
  }));
}

function CountItems(ItemIdToCheck) {
  let sqlInventory = JSON.parse(MyInventory);
  let amount = 0
  for (i in sqlInventory) {
    if (sqlInventory[i].item_id == ItemIdToCheck) {
      amount = amount + sqlInventory[i].amount
    }
  }
  return amount;
}

//itemid, amount, return

function CheckCraftFail(itemid, moveAmount) {
  let requirements = itemList[itemid].craft;

  if (!requirements) return true;

  let itemcheck = false;
  let weightcheck = false;

  let ingredientWeight = 0;
  let craftWeight = itemList[itemid].weight * moveAmount;

  let ingredientsJson = {};

  for (let i = 0; i < requirements.length; i++) {
      let requiredAmount = Math.ceil(moveAmount * requirements[i]['amount']);
      let itemNeededId = requirements[i]['itemid'];
      let countedItems = CountItems(itemNeededId);

      if (countedItems < requiredAmount) {
          itemcheck = true;
      } else {
          ingredientsJson[itemNeededId] = requiredAmount;
          ingredientWeight += itemList[itemNeededId].weight * requiredAmount;
      }
  }

  if (personalWeight + craftWeight - ingredientWeight > personalMaxWeight) {
      //Failed
      weightcheck = true;
  }

  if (!itemcheck && !weightcheck) {
      //Remove ingredients from inventory
      let sqlInventory = JSON.parse(MyInventory);
      for (let i = 0; i < parseInt(MyItemCount); i++) {
          let item = sqlInventory[i];
          if (item.item_id in ingredientsJson) {
              let amountDiff = item.amount - ingredientsJson[item.item_id];
              if (amountDiff > 0) {
                  //Have more than enough, so just change amount
                  sqlInventory[i].amount = amountDiff;
              } else {
                  //Have exactly enough, remove item
                  delete sqlInventory[i];
              }
          }
      }
      MyInventory = JSON.stringify(sqlInventory);
      MyItemCount = sqlInventory.length;
  }

  //InventoryLog("We should add " + moveAmount + " of " + itemid)
  return [itemcheck, weightcheck];
}

function AttemptDropInFilledSlot(slot) {

  let moveAmount = document.getElementById("move-amount").value;
  if (draggingid == slot) {
    EndDragError(slot);
    return
  }

  let item = document.getElementById(draggingid).getElementsByTagName('img')[0];
  if (item == undefined) {
    EndDragError(slot);
    return
  }
  let itemReturnItem = document.getElementById(slot).getElementsByTagName('img')[0];
  let itemidsent = item.dataset.itemid;

  let currentInventory = parseInt(item.dataset.inventory);
  let weight = parseInt(item.dataset.weight);
  let amount = parseInt(item.dataset.amount);
  let name = item.dataset.name;
  let itemid1 = item.dataset.itemid;
  let stackable = parseInt(item.dataset.stackable);

  let itemid2 = itemReturnItem.dataset.itemid;
  let returnItemInventory = itemReturnItem.dataset.inventory;
  let weightReturnItem = parseInt(itemReturnItem.dataset.weight);
  let amountReturnItem = parseInt(itemReturnItem.dataset.amount);
  let nameReturnItem = itemReturnItem.dataset.name;
  let inventoryDropName = document.getElementById(slot).parentElement.className;
  let inventoryReturnItemDropName = document.getElementById(draggingid).parentElement.className;

  let sameinventory = true;
  purchase = false;
  crafting = false;
  let movementWeight = weight * amount;
  let movementReturnItemWeight = weightReturnItem * amountReturnItem;

  let stacking = false;
  let fullstack = false;

  if (itemid1 == itemid2 && !stackable) {
    // here we are set to 0, which means the number for movement hasnt been changed so we default to try and move the entire stack over.
    if (moveAmount == 0) {
      fullstack = true;
      moveAmount = amount;
    }
    movementWeight = weight * moveAmount;
    movementReturnItemWeight = weightReturnItem * moveAmount;
    stacking = true;
  }

  let result = ErrorCheck(currentInventory, inventoryDropName, movementWeight)
  if (stacking == false) {
    // If the item is being stacked, we do not calculate the return weight here as no item will be returned to the starting inventory.
    result2 = ErrorCheck(returnItemInventory, inventoryReturnItemDropName, movementReturnItemWeight)
  }
  if (slot == NaN) {
    result2 = "Error"
    result = "You cant drop items in here"
  }
  else {
    // the item was stacked so its automatically successful for return item weight.
    result2 = "Success"
  }

  if (stacking && moveAmount > amount) {
    document.getElementById("move-amount").value = 0;
    result2 = "Warning"
    result = "You do not have that amount!"
  }

  if (inventoryDropName == "wrapsecondary" && TargetInventoryName.indexOf("Shop") > -1 || (!StoreOwner && PlayerStore && inventoryDropName == "wrapsecondary")) {
    result = "You can not drop items into the shop!";
    dragging = false;
    draggingid = "none";
  }

  if (TargetInventoryName == "Craft" || TargetInventoryName.indexOf("Craft") > -1) {
    result = "You can not drop items into the craft table or stack items that are crafted!";
  }

  if (result == "Success" && result2 == "Success") {

    // Here we are moving from player inventory to the secondary inventory
    if (currentInventory == 1 && inventoryDropName == "wrapsecondary") {
      const HiddenWorkouts = personalWeight + movementReturnItemWeight - movementWeight
      if (HiddenWorkouts > personalMaxWeight) {
        EndDragError(slot);
        return
      }
      item.dataset.inventory = 2;
      itemReturnItem.dataset.inventory = 1;
      if (stacking) {
        personalWeight = personalWeight - movementWeight
        secondaryWeight = secondaryWeight + movementWeight
      } else {
        personalWeight = personalWeight + movementReturnItemWeight - movementWeight
        secondaryWeight = secondaryWeight + movementWeight - movementReturnItemWeight
      }
      
    }

    // Here we are moving from secondary inventory to the player inventory.
    if (currentInventory == 2 && inventoryDropName == "wrapmain") {

      item.dataset.inventory = 1;
      itemReturnItem.dataset.inventory = 2;
      if (stacking) {
        personalWeight = personalWeight + movementWeight
        secondaryWeight = secondaryWeight - movementWeight
      } else {
        personalWeight = personalWeight + movementWeight - movementReturnItemWeight
        secondaryWeight = secondaryWeight + movementReturnItemWeight - movementWeight
      }
    }

    if (stacking == true) {

      if (inventoryDropName == "wrapmain") {
        itemReturnItem.dataset.inventory = 1;
      } else {
        itemReturnItem.dataset.inventory = 2;
      }

      if (currentInventory == 1) {
        item.dataset.inventory = 1;
      } else {
        item.dataset.inventory = 2;
      }

      let purchaseCost = parseInt(item.dataset.fwewef) * parseInt(moveAmount);

      if (TargetInventoryName == "Shop" || TargetInventoryName.indexOf("Shop") > -1 || (!StoreOwner && PlayerStore)) {
        InventoryLog("PURCHASE:")
        if (purchaseCost > userCash) {
          result = "You can not afford this, check your cash.";
          result2 = "You can not afford this, check your cash.";
          InventoryLog("Error: " + result)
          EndDragError(slot);
          return
        } else {

          if (itemList[itemidsent].weapon) {
            if (TargetInventoryName.indexOf("Shop-7") > -1) {
              if (!exluded[itemidsent] && brought) {
                result = "You can only buy one gun a day!";
                InventoryLog("Error: " + result)
                EndDragError(slot);
                return
              }
            }
          }
          // Filled Slot Info
          if (currentInventory == 2 && inventoryDropName == "wrapmain") {
            userCash = userCash - purchaseCost;
            InventoryLog("Purchase Cost: $" + purchaseCost + " you have $" + userCash + " left.")
            purchase = true;
          }
        }
      }

      InventoryLog(item.dataset.fwewef + " | " + purchaseCost + " | " + moveAmount);

      let newAmount = parseInt(amountReturnItem) + parseInt(moveAmount);
      itemReturnItem.dataset.amount = newAmount;
      item.dataset.currentslot = parseInt(slot.replace(/\D/g, ''));
      itemReturnItem.dataset.currentslot = parseInt(draggingid.replace(/\D/g, ''));


      if (fullstack == false) {
        let newAmount2 = parseInt(amount) - parseInt(moveAmount);
        item.dataset.amount = newAmount2;

        if (newAmount2 == 0) {
          document.getElementById(draggingid).innerHTML = "";
        }

        CompileStacks(parseInt(slot.replace(/\D/g, '')), parseInt(draggingid.replace(/\D/g, '')), inventoryDropName, inventoryReturnItemDropName, newAmount, newAmount2, moveAmount, purchase, purchaseCost, itemidsent, moveAmount)
      } else {

        document.getElementById(draggingid).innerHTML = "";

        CompileStacks(parseInt(slot.replace(/\D/g, '')), parseInt(draggingid.replace(/\D/g, '')), inventoryDropName, inventoryReturnItemDropName, newAmount, 0, moveAmount, purchase, purchaseCost, itemidsent, moveAmount)
      }

      let data = {}
      let targetQuality = itemReturnItem.dataset.quality
      let startQuality = item.dataset.quality

      if (startQuality < targetQuality) {

        data.inventory = item.dataset.inventoryname
        data.slot = parseInt(slot.replace(/\D/g, ''))
        data.information = item.dataset.info
        data.information.quality = startQuality

        UpdateQuality(data, startQuality)
      }

    } else {

      if (TargetInventoryName == "Shop" || TargetInventoryName.indexOf("Shop") > -1 || TargetInventoryName == "Craft" || (!StoreOwner && PlayerStore) || TargetInventoryName.indexOf("Craft") > -1) {
        result = "You can not drop items into the shop!";
        EndDragError(slot);
        InventoryLog("Error: " + result2 + " | " + result)
      } else {
        SwapStacks(parseInt(slot.replace(/\D/g, '')), parseInt(draggingid.replace(/\D/g, '')), inventoryDropName, inventoryReturnItemDropName)

        item.dataset.currentslot = parseInt(slot.replace(/\D/g, ''));
        itemReturnItem.dataset.currentslot = parseInt(draggingid.replace(/\D/g, ''));

        let currentdragHTML = document.getElementById(draggingid).innerHTML;
        let currentdropHTML = document.getElementById(slot).innerHTML;

        document.getElementById(draggingid).innerHTML = currentdropHTML;
        document.getElementById(slot).innerHTML = currentdragHTML;
      }
    }

    UpdateSetWeights()

    EndDrag(slot);

  } else {
    // errored?
    EndDragError(slot);
    InventoryLog("Error: " + result2 + " | " + result)
  }
}

function EndDragError(slot) {
  UpdateTextInformation(draggingid);
  UpdateTextInformation(slot);

  document.getElementById('draggedItem').style.opacity = '0.0'
  document.getElementById('draggedItem').innerHTML = "";

  dragging = false;
  draggingid = "none";
}

function EndDrag(slot) {
  UpdateTextInformation(draggingid);
  UpdateTextInformation(slot);
  dragging = false;
  draggingid = "none";
  document.getElementById('draggedItem').style.opacity = '0.0';
  document.getElementById('draggedItem').innerHTML = "";

}

function DisplayInformation(slot) {
  let item = document.getElementById(slot).getElementsByTagName('img')[0];

  let weight = parseInt(item.dataset.weight);
  let amount = parseInt(item.dataset.amount);
  let quality = item.dataset.quality;

  let name = item.dataset.name;
  let metainformation = item.dataset.metainformation;
  let stackable = parseInt(item.dataset.stackable);
  let color = "green"
  if (quality == undefined) {
    quality = 100
  }
  switch (quality) {
    case quality > 75:
      color = "#5FF03C"
      break;
    case quality > 50:
      color = "#74C242"
      break;
    case quality > 25:
      color = "#DEB837"
      break;
    case quality > 0:
      color = "#CC2727"
      break;
  }

  document.getElementById('CurrentInformation').innerHTML = "";

  if (quality != "" && quality != null && quality != "undefined") {
    document.getElementById('CurrentInformation').innerHTML = "<h2> " + name + "</h2> <div class='DispInfo'> " + metainformation + "</div> <br><hr><br><b>Weight</b>: " + weight.toFixed(2) + "<br><b>Amount</b>: " + amount + "" + "<br><b>Quality</b>: <font color=" + color + ">" + quality + "</font>" + "";
  } else {
    document.getElementById('CurrentInformation').innerHTML = "<h2> " + name + "</h2> <div class='DispInfo'> " + metainformation + "</div> <br><hr><br><b>Weight</b>: " + weight.toFixed(2) + "<br><b>Amount</b>: " + amount + "";
  }
}

function AttemptDropInEmptySlot(slot, isDropped, half) {
  let item = document.getElementById(draggingid).getElementsByTagName('img')[0];
  100;
  if (item == undefined) {
      EndDragError(slot);
      return;
  }

  let currentInventory = item.dataset.inventory;
  let weight = parseInt(item.dataset.weight);
  let amount = parseInt(item.dataset.amount);
  let inventoryReturnItemDropName = document.getElementById(draggingid).parentElement.className;
  let inventoryDropName = document.getElementById(slot).parentElement.className;
  let sameinventory = true;
  let movementWeight = weight * amount;
  purchase = false;
  crafting = false;
  let itemidsent = item.dataset.itemid;
  let metainformation = item.dataset.metainformation;
  let moveAmount = parseInt(document.getElementById('move-amount').value);

  let closeOnMove = false;

  //Prevent people from buying stacks of guns
  if (inventoryReturnItemDropName === 'wrapsecondary' && TargetInventoryName === 'Shop') {
      if (moveAmount > 1 && JSON.parse(item.dataset.stackable) == 1) moveAmount = 1;
      if (itemidsent === 'jailfood') {
          moveAmount = 1;
          closeOnMove = true;
      }
  }

  if (!moveAmount) {
      moveAmount = 0;
  }

  if (half && amount > 1) {
      moveAmount = Math.floor(amount / 2);
  }

  if (moveAmount > amount) {
      moveAmount = amount;
      //document.getElementById("move-amount").value = amount;
      //result = "You do not have that amount!";
  }

  let splitMove = false;
  if (moveAmount != 0 && moveAmount != amount) {
      splitMove = true;
      let alteredAmount = moveAmount;
      movementWeight = weight * alteredAmount;
  }

  if ((TargetInventoryName == "Shop" || TargetInventoryName === 'Craft') && inventoryReturnItemDropName == inventoryDropName) {
    EndDragError(slot);
    InventoryLog('Error: Exit the inventory to move this slot!');
    return
  }

  let result = 'Success';
  if (inventoryDropName === 'wrapmain' && inventoryReturnItemDropName === 'wrapsecondary' && TargetInventoryName == 'Craft') {
      // InventoryLog("eh: Crafting")
      inventoryReturnItemDropName = 'wrapsecondary';

      let [craftCheck, weightCheck] = CheckCraftFail(itemidsent, moveAmount);

      if (!craftCheck && !weightCheck && Number(currentInventory) === 2 && inventoryDropName === 'wrapmain') {
          InventoryLog('Attempted to craft item with itemid: ' + itemidsent);
          crafting = true;
          result = 'Success';
      } else {
          let result2 = 'Success';
          if (craftCheck) {
              result = 'You dont have the required materials!';
          }
          if (weightCheck) {
              result2 = 'The personal weight is too much.';
              $('.weightcontainer').eq(0).shake();
          }

          EndDragError(slot);
          InventoryLog('Error: ' + result + ' | ' + result2);
          return;
      }
  } else {
      result = ErrorCheck(currentInventory, inventoryDropName, movementWeight);
  }

  if (isDropped && inventoryReturnItemDropName == 'wrapsecondary') {
      result = 'Error: can not drop a dropped item';
  }

  if (
      (inventoryDropName == 'wrapsecondary' && TargetInventoryName == 'Shop') ||
      (inventoryDropName == 'wrapsecondary' && !StoreOwner && PlayerStore)
  ) {
      result = 'You can not drop items into the shop!';
  }
  if (inventoryDropName === 'wrapsecondary' && TargetInventoryName === 'Craft') {
      result = 'You can not drop items into the craft shop!';
  }

  if (inventoryDropName == 'wrapsecondary' && PlayerStore) {
      let isWeapon = itemList[itemidsent].weapon;
      if (isWeapon != undefined) {
          result = 'You can not move weapons while in player stores!';
      }
  }

  if (result == 'Success') {
      let purchaseCost = parseInt(item.dataset.fwewef) * parseInt(moveAmount);
      //InventoryLog(item.dataset.fwewef + " | " + purchaseCost + " | " + moveAmount);
      if (TargetInventoryName == 'Shop' || (!StoreOwner && PlayerStore)) {
          //InventoryLog("eh: PURCHASE")
          if (purchaseCost > userCash) {
              result = 'You cant afford that, dumbass!';
              EndDragError(slot);
              InventoryLog('Error: ' + result);
              //userCash = userCash - purchaseCost; unsure why we are taking money on not enough money taken
              return;
          } else {
            // Empty slot info
              if (currentInventory == 2 && inventoryDropName == 'wrapmain') {
                userCash = userCash - purchaseCost;
                $.post("http://erp-inventory/checkBusinessShop", JSON.stringify([item.dataset, purchaseCost]));
                InventoryLog('Purchase Cost: $' + purchaseCost + ' you have $' + userCash + ' left.');
                purchase = true;
              }
          }
      }

      // moving from player to secondat
      if (currentInventory == 1 && (inventoryDropName == 'wrapsecondary' || isDropped)) {
          // tell lua the new location and stuff?
          personalWeight = personalWeight - movementWeight;
          if (!isDropped) {
              item.dataset.inventory = 2;
              secondaryWeight = secondaryWeight + movementWeight;
          }
      }

      //moving from secondary to player
      if (currentInventory == 2 && (inventoryDropName == 'wrapmain' || isDropped)) {
          // tell lua the new location and stuff?
          secondaryWeight = secondaryWeight - movementWeight;
          if (!isDropped) {
              item.dataset.inventory = 1;
              personalWeight = personalWeight + movementWeight;
          }
      }

      if (!crafting) UpdateSetWeights('');

      if (splitMove || purchase) {
          if (!isDropped) {
              document.getElementById(slot).innerHTML = document.getElementById(draggingid).innerHTML;
          }

          let item = document.getElementById(draggingid).getElementsByTagName('img')[0];
          let itemNewItem = document.getElementById(slot).getElementsByTagName('img')[0];
          let startAmount = parseInt(item.dataset.amount);

          itemNewItem.dataset.amount = parseInt(moveAmount);

          if (inventoryDropName == 'wrapsecondary') {
              itemNewItem.dataset.inventory = 2;
          } else {
              itemNewItem.dataset.inventory = 1;
          }

          item.dataset.amount = startAmount - parseInt(moveAmount);
          itemNewItem.dataset.currentslot = parseInt(slot.replace(/\D/g, ''));

          let oldDragId = draggingid;

          if (!isDropped) {
              CompileStacks(
                  parseInt(slot.replace(/\D/g, '')),
                  parseInt(oldDragId.replace(/\D/g, '')),
                  inventoryDropName,
                  inventoryReturnItemDropName,
                  moveAmount,
                  item.dataset.amount,
                  moveAmount,
                  purchase,
                  purchaseCost,
                  itemidsent,
                  moveAmount,
              );

              EndDrag(slot);
          } else {
              DropItem(oldDragId, moveAmount);
          }

          if (parseInt(item.dataset.amount) < 1) {
              document.getElementById(oldDragId).innerHTML = '';
          }

          if (!isDropped) {
              item.dataset.inventory = currentInventory;
          }

          EndDrag(oldDragId);
      } else {
          let oldDragId = draggingid;
          if (!isDropped) {
              MoveStack(
                  parseInt(slot.replace(/\D/g, '')),
                  parseInt(oldDragId.replace(/\D/g, '')),
                  inventoryDropName,
                  inventoryReturnItemDropName,
                  purchase,
                  purchaseCost,
                  itemidsent,
                  metainformation,
                  moveAmount,
              );

              if (inventoryDropName == 'wrapsecondary') {
                  item.dataset.inventory = 2;
              } else {
                  item.dataset.inventory = 1;
              }

              item.dataset.currentslot = parseInt(slot.replace(/\D/g, ''));
              if (document.getElementById(draggingid)) {
                  document.getElementById(slot).innerHTML = document.getElementById(draggingid).innerHTML;
              }

              EndDrag(slot);
          } else {
              let item = document.getElementById(draggingid).getElementsByTagName('img')[0];
              item.dataset.amount = 0;
              DropItem(draggingid, amount);
              EndDrag(slot);
          }

          document.getElementById(oldDragId).innerHTML = '';
      }
      if (closeOnMove) {
          closeInv();
      }
  } else {
      if (isDropped) {
          CleanEndDrag();
          InventoryLog('Error: ' + result);
      } else {
          EndDragError(slot);
          // errored?
          InventoryLog('Error: ' + result);
      }
  }
}

function CleanEndDrag() {
  $('#draggedItem').css('opacity', 0.0);
  document.getElementById('draggedItem').innerHTML = "";
  dragging = false;
  draggingid = "none";
}

function DisplayDataSet(slot) {
  let item = document.getElementById(slot).getElementsByTagName('img')[0];
  //Example of displaying dataset information to the image AKA item we are manipulating so we can do w/e the fuck we want with that slot
}

function RequestItemData() {

  let item = document.getElementById(draggingid).getElementsByTagName('img')[0];

  currentInventory = item.dataset.inventory;
  weight = item.dataset.weight;
  amount = item.dataset.amount;
  name = item.dataset.name;
  itemid = item.dataset.itemid;
  inventoryUsedName = item.dataset.inventoryname;
  slotusing = item.dataset.currentslot;
  durability = item.dataset.quality;
}

function EndDragUsage(type) {
  EndDrag(slot);
  let slot = type

  dragging = false;
  draggingid = "none";

  $('#draggedItem').css('opacity', 0.0);
  document.getElementById('draggedItem').innerHTML = "";
}

function useitem() {

  if (dragging != false) {
    RequestItemData()
    let isWeapon = itemList[itemid].weapon;
    if (isWeapon === undefined) {
      isWeapon = false;
    }

    if (inventoryUsedName == PlayerInventoryName) {
      $.post("http://erp-inventory/invuse", JSON.stringify([inventoryUsedName, itemid, slotusing, isWeapon, durability]));
      InventoryLog("Using item: " + name + "(" + amount + ") from " + inventoryUsedName + " | slot " + slotusing)
    }
    EndDrag(slotusing);
    closeInv(true)
  }
}
</script>